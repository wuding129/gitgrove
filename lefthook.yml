# Gitè§„èŒƒåŒ–å·¥ä½œæµé…ç½®
# åˆ†æ”¯åˆ›å»ºçº¦æŸå’Œæäº¤è§„èŒƒéªŒè¯

# åˆ†æ”¯æ¨é€å‰çš„éªŒè¯ - ç”¨äºæ‹¦æˆªä¸è§„èŒƒåˆ†æ”¯
pre-push:
  commands:
    branch-name-check:
      run: |
        # è·å–å½“å‰åˆ†æ”¯å
        current_branch=$(git branch --show-current 2>/dev/null || git rev-parse --abbrev-ref HEAD)
        
        # è·³è¿‡master/mainåˆ†æ”¯çš„æ£€æŸ¥
        if [ "$current_branch" = "master" ] || [ "$current_branch" = "main" ]; then
          exit 0
        fi
        
        # åˆ†æ”¯å‘½åè§„èŒƒæ ¡éªŒ - ä½¿ç”¨POSIXå…¼å®¹çš„å­—ç¬¦ä¸²åŒ¹é…
        case "$current_branch" in
          feature_*|hotfix_*|bugfix_*)
            echo "âœ… åˆ†æ”¯åç§°ç¬¦åˆè§„èŒƒ: $current_branch"
            ;;
          *)
            echo "âŒ é”™è¯¯: åˆ†æ”¯å '$current_branch' ä¸ç¬¦åˆè§„èŒƒ!"
            echo "ğŸ“‹ æ­£ç¡®æ ¼å¼:"
            echo "   ğŸ”¹ feature_[æ¨¡å—]_[æè¿°] (ä¾‹: feature_user_login)"
            echo "   ğŸ”¹ hotfix_v[ç‰ˆæœ¬]_[æè¿°] (ä¾‹: hotfix_v1.0.3_login_fix)"
            echo "   ğŸ”¹ bugfix_[æè¿°] (ä¾‹: bugfix_scroll_error)"
            echo ""
            echo "ğŸ’¡ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè§„èŒƒåˆ†æ”¯:"
            echo "   gg branch æˆ– gg b (äº¤äº’å¼åˆ›å»ºåˆ†æ”¯)"
            exit 1
            ;;
        esac

# æäº¤ä¿¡æ¯éªŒè¯
commit-msg:
  commands:
    commitlint:
      run: npx --no-install commitlint --edit {1}
      stage_fixed: true

# æäº¤å‰çš„ä»£ç æ£€æŸ¥
pre-commit:
  commands:    # é˜²æ­¢ç›´æ¥æäº¤åˆ°masteråˆ†æ”¯ (Windowså…¼å®¹ç‰ˆæœ¬)
    protect-master:
      run: node scripts/protect-master.js
        
    # ä»£ç è´¨é‡æ£€æŸ¥
    lint-staged:
      glob: "*.{js,ts,vue,jsx,tsx}"
      run: |
        echo "ğŸ” æ£€æŸ¥ä»£ç æ ¼å¼..."
        # è¿™é‡Œå¯ä»¥æ·»åŠ ESLintç­‰ä»£ç æ£€æŸ¥å·¥å…·
        # npx eslint {staged_files} --fix
        echo "âœ… ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡"
